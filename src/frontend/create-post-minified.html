<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Create a green blog post!</title><link rel="stylesheet" href="dist/styles/main.css"><style>body{padding:15px}input{color:#fff}.text-input{font-style:normal;font-weight:700;font-size:40px;line-height:45px;font-family:"Courier New",serif;color:#aaa;background:0 0;border:none;margin-bottom:50px;text-align:center;width:100%}.text-input:focus,.textarea-input:focus{outline:0}.textarea-input{width:100%;height:40vh;background:0 0;font-family:'Courier New',serif;font-style:normal;font-weight:400;font-size:18px;line-height:20px;color:#aaa;padding:5px;margin-bottom:15px}.button-primary{font-family:'Courier New',serif;font-style:normal;font-weight:400;font-size:18px;line-height:20px;background:#fcac00;border-radius:4px;cursor:pointer;padding:10px}.content{display:flex;gap:20px;flex-direction:row;height:100%;margin-top:50px}.centered-form{display:flex;flex-direction:column;align-items:end;width:60%;padding:15px}.media-upload{display:flex;flex-direction:column;width:40%;align-items:start}.file-previews-table{text-align:left;border-collapse:collapse;width:100%;margin-top:15px}.file-previews-table th{color:#fff;border-bottom:1px solid #fff}.file-previews-table td{color:#fff;padding:10px}</style></head><body><h1>Now Green <span style="color:#fcac00">Blog</span> You Got</h1><h3>Your guide how to save an energy...</h3><div class="content"><div class="centered-form"><input type="text" id="title" placeholder="Title" class="text-input"><textarea id="content" placeholder="Content" class="textarea-input"></textarea><button id="create-button" class="button-primary">Create</button><p id="uploadState" style="color:#fff"></p></div><div class="media-upload"><h2>Upload your media files</h2><h3>Choose carefully what you want to upload</h3><button class="button-primary" id="file-upload-button">Upload</button><input type="file" id="file-upload" name="avatar" accept="image/png, image/jpeg, video/*" multiple="multiple" class="file-upload" hidden><table id="file-previews" class="file-previews-table"><tr><th style="width:50%">Preview</th><th>Image code</th></tr></table></div></div><script>const HOST_NAME="http://localhost:3000";document.getElementById("create-button").addEventListener("click",sendPost),document.getElementById("file-upload").addEventListener("change",handleFile),document.getElementById("file-upload-button").addEventListener("click",()=>{document.getElementById("file-upload").click()});const uploadQueue=[],uploadedFilesData=[];function handleFile(){for(let e=0;e<this.files.length;e++){let t=this.files[e],l=t.type.startsWith("video/");document.getElementById("file-previews").innerHTML+=`
            <tr>
                <td><img src="${URL.createObjectURL(t)}" width="200px" alt="image"></td>
                <td>
                    <p>${t.name}</p>
                    <p>Code: ![${l?"video":"image"}](${uploadQueue.length})</p>
                </td>
            </tr>
            `,uploadQueue.push(t)}this.value=null}function sendPost(){submitFiles()}function submitPost(){let e=document.getElementById("title").value,t=document.getElementById("content").value;fetch(`${HOST_NAME}/create-post`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:"adam",title:e,content:t,files:uploadedFilesData})}).then(async e=>{let t=await e.text();200===e.status?document.getElementById("uploadState").innerHTML=`Post ID: <a href="http://localhost:3000/posts/adam/${t}">${t}</a>`:document.getElementById("uploadState").innerText=`Error: ${e.status}`,uploadQueue.length=0,uploadedFilesData.length=0,document.getElementById("file-previews").innerHTML="",document.getElementById("title").value="",document.getElementById("content").value=""})}function submitFiles(){let e=uploadQueue.length,t=0;0===uploadQueue.length&&submitPost(),uploadQueue.forEach((l,n)=>{let a=new XMLHttpRequest;a.open("POST",`${HOST_NAME}/upload`,!0),a.upload.onprogress=function(t){let l=t.loaded/t.total*100;document.getElementById("uploadState").innerText=`Uploading media ${n+1}/${e}: ${l.toFixed(2)}%`},a.onload=o=>{200!==a.status&&console.log("ERROR"),uploadedFilesData.push({filename:l.name,slug:a.responseText,code:`${n}`}),(t+=1)===e&&submitPost()},a.onerror=e=>{console.log("ERROR")},a.send(l)})}</script></body></html>
